// ============================================================
// OpenClaw Configuration â€” Hyojin Distribution AI Agent Team
// ~/.openclaw/openclaw.json  (mounted via Docker volume)
//
// JSON5 format: comments and trailing commas are allowed.
// Env vars: use ${VAR_NAME} â€” resolved from .env / process env.
// Docs: https://docs.openclaw.ai/gateway/configuration-reference
// ============================================================
{
  // ------------------------------------------------------------
  // Gateway: bind to LAN so Nginx (same Docker network) can reach it.
  // Port 18789 = Gateway WebSocket control plane.
  // NEVER expose 18789 directly to the public internet â€” Nginx only.
  // ------------------------------------------------------------
  gateway: {
    mode: "local",
    port: 18789,
    bind: "lan",
    auth: {
      mode: "token",
      token: "${OPENCLAW_GATEWAY_TOKEN}",
    },
  },

  // ------------------------------------------------------------
  // Logging â€” write to a shared volume so BudgetGuard can parse it.
  // ------------------------------------------------------------
  logging: {
    level: "info",
    file: "/shared/logs/openclaw.log",
    consoleLevel: "info",
    consoleStyle: "json",
    redactSensitive: "tools",
  },

  // ------------------------------------------------------------
  // Channels â€” Telegram only (CEO â†” Chief Secretary 1:1)
  // ------------------------------------------------------------
  channels: {
    telegram: {
      enabled: true,
      botToken: "${TELEGRAM_BOT_TOKEN}",

      // Security: ONLY the CEO can interact with the bot.
      // dmPolicy "allowlist" = drop all DMs not in allowFrom.
      dmPolicy: "allowlist",
      allowFrom: ["${CEO_TELEGRAM_ID}"],

      historyLimit: 20,
      mediaMaxMb: 10,
    },
  },

  // ------------------------------------------------------------
  // Bindings: route Telegram â†’ Chief Secretary agent only.
  // Team agents are internal â€” they receive tasks via sessions_send.
  // ------------------------------------------------------------
  bindings: [
    {
      agentId: "chief-secretary",
      match: { channel: "telegram" },
    },
  ],

  // ------------------------------------------------------------
  // Agents: 1 Chief Secretary (dual-mode) + 1 Chief Secretary Pro + 6 Team Agents
  // Each agent has its own workspace (separate SOUL.md per agent).
  //
  // Model assignments:
  //   Chief Secretary     : flash  (fast routing + daily comms + complexity detection)
  //   Chief Secretary Pro : pro    (strategic analysis engine â€” internal only, no Telegram)
  //   Planning PM         : pro    (complex strategy/research)
  //   Marketer            : flash  (ad data is mostly structured)
  //   Designer            : flash  (visual guidance / creative briefs)
  //   Finance Manager     : pro    (accurate financial analysis)
  //   CS Manager          : flash  (templated customer responses)
  //   Asset Manager       : pro    (financial risk â€” always pro, no flash fallback on analysis)
  //
  // Dual-model routing:
  //   Simple tasks  â†’ chief-secretary (flash) handles directly  [1~3s]
  //   Complex tasks â†’ chief-secretary detects â†’ routes to chief-secretary-pro (pro) â†’ relays to CEO  [30~55s]
  // ------------------------------------------------------------
  agents: {
    defaults: {
      // Default Flash model â€” overridden per-agent below.
      model: {
        primary: "${LLM_FLASH_MODEL}",
        fallbacks: [],
      },
      sandbox: {
        mode: "off",
      },
    },

    list: [
      // --------------------------------------------------------
      // 1. Chief Secretary (ë¹„ì„œì‹¤ì¥) â€” default agent, faces the CEO.
      // --------------------------------------------------------
      {
        id: "chief-secretary",
        default: true,
        name: "ë¹„ì„œì‹¤ì¥",
        workspace: "/home/node/.openclaw/workspace/chief-secretary",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ë¹„ì„œì‹¤ì¥",
          emoji: "ğŸ¤µ",
        },
        // Allow chief-secretary to spawn all team agents as sub-sessions.
        // sessions_spawn is the correct tool for calling internal agents
        // that don't have persistent Telegram-bound sessions.
        subagents: {
          allowAgents: ["chief-secretary-pro", "planning-pm", "marketer", "designer", "finance-manager", "cs-manager", "asset-manager"],
        },
      },

      // --------------------------------------------------------
      // 1b. Chief Secretary Pro (ë¹„ì„œì‹¤ì¥-Pro) â€” Internal strategic analysis engine.
      // NOT bound to Telegram. Receives tasks from chief-secretary via sessions_send.
      // Uses Pro model for deep reasoning, strategic judgment, and multi-agent synthesis.
      // --------------------------------------------------------
      {
        id: "chief-secretary-pro",
        name: "ë¹„ì„œì‹¤ì¥-Pro",
        workspace: "/home/node/.openclaw/workspace/chief-secretary-pro",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "ë¹„ì„œì‹¤ì¥-Pro",
          emoji: "ğŸ§ ",
        },
      },

      // --------------------------------------------------------
      // 2. Planning PM (ê¸°íšPM)
      // --------------------------------------------------------
      {
        id: "planning-pm",
        name: "ê¸°íšPM",
        workspace: "/home/node/.openclaw/workspace/planning-pm",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "ê¸°íšPM",
          emoji: "ğŸ“‹",
        },
      },

      // --------------------------------------------------------
      // 3. Marketer (ë§ˆì¼€í„°)
      // --------------------------------------------------------
      {
        id: "marketer",
        name: "ë§ˆì¼€í„°",
        workspace: "/home/node/.openclaw/workspace/marketer",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ë§ˆì¼€í„°",
          emoji: "ğŸ“£",
        },
      },

      // --------------------------------------------------------
      // 4. Designer (ë””ìì´ë„ˆ)
      // --------------------------------------------------------
      {
        id: "designer",
        name: "ë””ìì´ë„ˆ",
        workspace: "/home/node/.openclaw/workspace/designer",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ë””ìì´ë„ˆ",
          emoji: "ğŸ¨",
        },
      },

      // --------------------------------------------------------
      // 5. Finance Manager (ì¬ë¬´ë‹´ë‹¹)
      // --------------------------------------------------------
      {
        id: "finance-manager",
        name: "ì¬ë¬´ë‹´ë‹¹",
        workspace: "/home/node/.openclaw/workspace/finance-manager",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "ì¬ë¬´ë‹´ë‹¹",
          emoji: "ğŸ’°",
        },
      },

      // --------------------------------------------------------
      // 6. CS Manager (CSë‹´ë‹¹)
      // --------------------------------------------------------
      {
        id: "cs-manager",
        name: "CSë‹´ë‹¹",
        workspace: "/home/node/.openclaw/workspace/cs-manager",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "CSë‹´ë‹¹",
          emoji: "ğŸ§",
        },
      },

      // --------------------------------------------------------
      // 7. Asset Manager (ìì‚°ê´€ë¦¬ì‚¬) â€” Internal VIP investment agent.
      // NOT bound to Telegram. Receives tasks from chief-secretary via sessions_send.
      // Uses Pro model for financial analysis. Bybit API to be added later by CEO.
      // --------------------------------------------------------
      {
        id: "asset-manager",
        name: "ìì‚°ê´€ë¦¬ì‚¬",
        workspace: "/home/node/.openclaw/workspace/asset-manager",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "ìì‚°ê´€ë¦¬ì‚¬",
          emoji: "ğŸ“ˆ",
        },
      },
    ],
  },

  // ------------------------------------------------------------
  // Session management â€” per-sender DM scope, no reset (pairing persists for cron reliability)
  // historyLimit: 20 in telegram config already caps LLM context per request.
  // ------------------------------------------------------------
  session: {
    scope: "per-sender",
    dmScope: "per-channel-peer",
  },

  // ------------------------------------------------------------
  // Tools â€” disable built-in web_search (Brave-only).
  // All web searches go through the tavily-search ClawHub skill instead.
  // ------------------------------------------------------------
  tools: {
    web: {
      search: {
        enabled: false,
      },
    },
  },

  // ------------------------------------------------------------
  // Messages â€” Korean UX polish
  // ------------------------------------------------------------
  messages: {
    ackReaction: "ğŸ‘€",
    ackReactionScope: "all",
    queue: {
      mode: "collect",
      debounceMs: 800,
      cap: 10,
    },
  },
}
