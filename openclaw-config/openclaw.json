// ============================================================
// OpenClaw Configuration ‚Äî Hyojin Distribution AI Agent Team
// ~/.openclaw/openclaw.json  (mounted via Docker volume)
//
// JSON5 format: comments and trailing commas are allowed.
// Env vars: use ${VAR_NAME} ‚Äî resolved from .env / process env.
// Docs: https://docs.openclaw.ai/gateway/configuration-reference
// ============================================================
{
  // ------------------------------------------------------------
  // Gateway: bind to LAN so Nginx (same Docker network) can reach it.
  // Port 18789 = Gateway WebSocket control plane.
  // NEVER expose 18789 directly to the public internet ‚Äî Nginx only.
  // ------------------------------------------------------------
  gateway: {
    port: 18789,
    bind: "lan",
    auth: {
      mode: "token",
      token: "${OPENCLAW_GATEWAY_TOKEN}",
    },
  },

  // ------------------------------------------------------------
  // Logging ‚Äî write to a shared volume so BudgetGuard can parse it.
  // ------------------------------------------------------------
  logging: {
    level: "info",
    file: "/shared/logs/openclaw.log",
    consoleLevel: "info",
    consoleStyle: "json",
    redactSensitive: "tools",
  },

  // ------------------------------------------------------------
  // Channels ‚Äî Telegram only (CEO ‚Üî Chief Secretary 1:1)
  // ------------------------------------------------------------
  channels: {
    telegram: {
      enabled: true,
      botToken: "${TELEGRAM_BOT_TOKEN}",

      // Webhook mode: Nginx proxies HTTPS ‚Üí OpenClaw internal listener.
      webhookUrl: "https://${DOMAIN}/telegram-webhook",
      webhookPath: "/telegram-webhook",
      webhookHost: "0.0.0.0",   // bind to all interfaces inside container

      // Security: ONLY the CEO can interact with the bot.
      // dmPolicy "allowlist" = drop all DMs not in allowFrom.
      dmPolicy: "allowlist",
      allowFrom: ["${CEO_TELEGRAM_ID}"],

      historyLimit: 20,
      mediaMaxMb: 10,
    },
  },

  // ------------------------------------------------------------
  // Bindings: route Telegram ‚Üí Chief Secretary agent only.
  // Team agents are internal ‚Äî they receive tasks via sessions_send.
  // ------------------------------------------------------------
  bindings: [
    {
      agentId: "chief-secretary",
      match: { channel: "telegram" },
    },
  ],

  // ------------------------------------------------------------
  // Agents: 1 Chief Secretary + 5 Team Agents
  // Each agent has its own workspace (separate SOUL.md per agent).
  //
  // Model assignments (all env-var driven for easy swapping):
  //   Chief Secretary : flash  (efficient routing + daily comms)
  //   Planning PM     : pro    (complex strategy/research)
  //   Marketer        : flash  (ad data is mostly structured)
  //   Designer        : flash  (visual guidance / creative briefs)
  //   Finance Manager : pro    (accurate financial analysis)
  //   CS Manager      : flash  (templated customer responses)
  // ------------------------------------------------------------
  agents: {
    defaults: {
      // Default Flash model ‚Äî overridden per-agent below.
      model: {
        primary: "${LLM_FLASH_MODEL}",
        fallbacks: [],
      },
      sandbox: {
        mode: "off",
      },
    },

    list: [
      // --------------------------------------------------------
      // 1. Chief Secretary (ÎπÑÏÑúÏã§Ïû•) ‚Äî default agent, faces the CEO.
      // --------------------------------------------------------
      {
        id: "chief-secretary",
        default: true,
        name: "ÎπÑÏÑúÏã§Ïû•",
        workspace: "/home/node/.openclaw/workspace/chief-secretary",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ÎπÑÏÑúÏã§Ïû•",
          emoji: "ü§µ",
        },
      },

      // --------------------------------------------------------
      // 2. Planning PM (Í∏∞ÌöçPM)
      // --------------------------------------------------------
      {
        id: "planning-pm",
        name: "Í∏∞ÌöçPM",
        workspace: "/home/node/.openclaw/workspace/planning-pm",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "Í∏∞ÌöçPM",
          emoji: "üìã",
        },
      },

      // --------------------------------------------------------
      // 3. Marketer (ÎßàÏºÄÌÑ∞)
      // --------------------------------------------------------
      {
        id: "marketer",
        name: "ÎßàÏºÄÌÑ∞",
        workspace: "/home/node/.openclaw/workspace/marketer",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ÎßàÏºÄÌÑ∞",
          emoji: "üì£",
        },
      },

      // --------------------------------------------------------
      // 4. Designer (ÎîîÏûêÏù¥ÎÑà)
      // --------------------------------------------------------
      {
        id: "designer",
        name: "ÎîîÏûêÏù¥ÎÑà",
        workspace: "/home/node/.openclaw/workspace/designer",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "ÎîîÏûêÏù¥ÎÑà",
          emoji: "üé®",
        },
      },

      // --------------------------------------------------------
      // 5. Finance Manager (Ïû¨Î¨¥Îã¥Îãπ)
      // --------------------------------------------------------
      {
        id: "finance-manager",
        name: "Ïû¨Î¨¥Îã¥Îãπ",
        workspace: "/home/node/.openclaw/workspace/finance-manager",
        model: {
          primary: "${LLM_PRO_MODEL}",
          fallbacks: ["${LLM_FLASH_MODEL}"],
        },
        identity: {
          name: "Ïû¨Î¨¥Îã¥Îãπ",
          emoji: "üí∞",
        },
      },

      // --------------------------------------------------------
      // 6. CS Manager (CSÎã¥Îãπ)
      // --------------------------------------------------------
      {
        id: "cs-manager",
        name: "CSÎã¥Îãπ",
        workspace: "/home/node/.openclaw/workspace/cs-manager",
        model: {
          primary: "${LLM_FLASH_MODEL}",
          fallbacks: [],
        },
        identity: {
          name: "CSÎã¥Îãπ",
          emoji: "üéß",
        },
      },
    ],
  },

  // ------------------------------------------------------------
  // Session management ‚Äî per-sender DM scope, daily reset at 3am KST
  // ------------------------------------------------------------
  session: {
    scope: "per-sender",
    dmScope: "per-channel-peer",
    reset: {
      mode: "daily",
      atHour: 3,
    },
  },

  // ------------------------------------------------------------
  // Messages ‚Äî Korean UX polish
  // ------------------------------------------------------------
  messages: {
    ackReaction: "üëÄ",
    ackReactionScope: "all",
    queue: {
      mode: "collect",
      debounceMs: 800,
      cap: 10,
    },
  },
}
